## Detailed Systems Design for `sabs-parent/server` Project (Laravel API & Web)

This document outlines the system design for the `sabs-parent/server` project, focusing on its role as a comprehensive Laravel backend serving both a RESTful API for the `sabsv3` React Native mobile application and a web interface. It covers the component, functional, and people views to provide a comprehensive understanding for both technical and non-technical stakeholders, specifically highlighting features exposed via defined routes relevant to the mobile application's API connection.

### 1. Introduction

The `sabs-parent/server` project is a Laravel-based backend application designed to provide API services primarily to the `sabsv3` Expo React Native mobile application, alongside a full-featured web interface. It acts as a central hub for data management, business logic execution, and integration with various external services. The system manages financial transactions, user accounts, loans, savings, and other related services within a CRM-like context.

### 2. Functional View

The system offers a wide range of functionalities, exposed through both a RESTful API and a traditional web interface. This overview prioritizes functionalities directly consumed by the mobile application via the API.

#### 2.1. User and Authentication Management (API & Web)
*   **User Registration:** Allows new users (customers, agents, system users) to register. Accessible via both web forms and API endpoints.
*   **User Authentication (Login):** Secure login via web forms (session-based) and API tokens (token-based). Includes password reset functionality.
*   **User Profiles:** Retrieval and update of user-specific information via API and web.
*   **Role-Based Access Control (RBAC):** Leverages `spatie/laravel-permission` to manage user roles and permissions, ensuring secure access to specific functionalities across both web and API interfaces.
*   **Session Management:** Standard Laravel session handling for web routes, and API token-based authentication for API routes.

#### 2.2. Customer and Account Management (API & Web)
*   **Customer Listings:** Retrieve lists of customers and agents. Accessible via web (grid views) and API.
*   **Customer Details:** Get detailed information for a specific customer. Accessible via web and API.
*   **Customer Search:** Search customers by various criteria, including account number. Accessible via web and API.
*   **Account Types:** Manage different types of accounts (e.g., savings, loans). Accessible via web and API.
*   **Account Operations:** Deposits, withdrawals, and reversals for various account types. Accessible via web and API.
*   **Susu Accounts:** Specific functionalities for managing "Susu" (informal savings/credit) accounts, including checking status, retrieving details, initiating deposits/withdrawals, and completing cycles. Primarily exposed via API.

#### 2.3. Loan Management (API & Web)
*   **Loan Requests:** Manage incoming loan applications. Accessible via web and API.
*   **Loan Accounts:** Administer individual loan accounts. Accessible via web and API.
*   **Loan Migrations:** Functionality related to migrating loan data. Accessible via web and API.
*   **Loan Purposes:** Manage predefined reasons or categories for loans. Accessible via web and API.
*   **Loan Repayments:** Process and track loan repayment transactions. Accessible via web and API.

#### 2.4. CRM Modules (Primarily Web Interface)
*   **Contact Management:** Create, view, edit, and delete contacts.
*   **Lead Management:** Track and manage leads, including conversion to accounts and lead ordering.
*   **Opportunity Management:** Manage sales opportunities through various stages.
*   **Case Management:** Handle common cases and inquiries.
*   **Activity Management:** Schedule and track meetings, calls, and tasks.
*   **Document Management:** Organize and manage documents within folders.
*   **Campaign Management:** Plan and execute marketing campaigns.
*   **Target List Management:** Create and manage targeted lists.
*   **Product Catalog:** Manage products, categories, brands, and taxes.
*   **Sales Orders:** Create, manage, preview, and generate PDFs for sales orders.
*   **Invoicing:** Generate, manage, preview, and create PDFs for invoices.
*   **Quotes:** Create, manage, preview, and generate PDFs for quotes.

#### 2.5. Transaction Management and Reporting (API & Web)
*   **Transaction History:** Retrieve detailed transaction logs for users and accounts. Accessible via web and API.
*   **Dashboard Analytics:** Provide aggregated data for various timeframes (today, this week, this month, this year, all time) covering deposits, withdrawals, loan requests, etc. Accessible via web and API.
*   **Daily Collections:** Track daily deposit and withdrawal activities. Accessible via web and API.
*   **Agent Mobilization Reports:** Analyze agent performance by products for both deposits and withdrawals. Accessible via web and API.
*   **System Reports:** Generate various system-wide reports (leads, invoices, sales orders, quotes analytics). Accessible via web and API.
*   **Printed Statements:** Functionality to retrieve data for printing statements, transactions, deposits, withdrawals, and account balances. Primarily exposed via API.
*   **Export Functionality:** Export transaction data to CSV (Web).

#### 2.6. System Configuration and Utilities (API & Web)
*   **Company Information:** Manage and update company-specific information. Accessible via web and API.
*   **System Settings:** Configure various business, company, email, system, and pusher settings via the web interface. Includes email testing utility.
*   **Language Management:** Change and manage application languages via web interface.
*   **Subscription Plans:** Manage and upgrade user subscription plans via web.
*   **Form Builder:** Create, manage, and respond to custom forms via web, with public form links.
*   **SMS Services:** Functionality for company SMS transactions. Primarily exposed via API.
*   **Product/Service Management:** Retrieve system products/services for clients. Primarily exposed via API.
*   **Monthly Deductions:** Process monthly deductions. Primarily exposed via API.
*   **Confirmation Codes:** Send confirmation codes (e.g., for transactions or verifications). Primarily exposed via API.
*   **Financial Details:** Retrieve account balance, commission values, and account balance with charges. Primarily exposed via API.
*   **Calendar:** A calendar feature accessible via web.
*   **Change Mode:** A utility to change user mode (Web).

#### 2.7. Integrations (Relevant to Mobile App API)
*   **mymtn endpoint:** Suggests a custom integration with MTN (a mobile network operator, likely for mobile money or other services) via API.

### 3. Component View

The system is built on the Laravel framework and primarily follows a Model-View-Controller (MVC) architectural pattern.

#### 3.1. Core Framework and Language
*   **Laravel 7:** The foundational PHP framework providing structure, ORM (Eloquent), routing, middleware, and other essential services.
*   **PHP 7.2.5+:** The core programming language.

#### 3.2. Data Layer
*   **Eloquent ORM:** Laravel's built-in Object-Relational Mapper, used extensively for interacting with the database. Each `.php` file in the `app/` directory (e.g., `User.php`, `Account.php`, `Loanrequests.php`) represents an Eloquent model, mapping to a corresponding database table.
*   **Database:** The choice of database is not explicitly stated, but `doctrine/dbal` in `composer.json` suggests compatibility with various relational databases (e.g., MySQL, PostgreSQL).

#### 3.3. Application Layer (Controllers, Views, Routes, Middleware)
*   **Routing (`routes/api.php`, `routes/web.php`):** Defines all API and web endpoints, mapping HTTP methods (GET, POST, DELETE, PUT/PATCH) to specific controller actions.
*   **Controllers (`app/Http/Controllers`):** Handle incoming requests (both API and web), process data, interact with models/services, and return appropriate responses (JSON for API, Blade views for web).
    *   `ApiUsersController`: Central to API functionalities, handling user, customer, account, transaction, and reporting logic for the mobile app.
    *   `AuthController`: Manages user authentication (login, registration).
    *   Numerous other controllers (e.g., `AccountController`, `LoanRequestsController`, `InvoiceController`, `UserController`, `ReportController`, `SettingController`) provide logic for specific web-based modules and administrative functions, often complementing or sharing logic with API functionalities.
*   **Views (`resources/views`):** Blade templates are used to render the web interface.
*   **Middleware (`app/Http/Kernel.php`):**
    *   **Authentication Middleware (`auth`, `auth:api`):** Verifies user sessions for web routes and API tokens for protected API routes.
    *   **CORS Middleware (`Fruitcake\Cors\HandleCors`):** Manages Cross-Origin Resource Sharing, allowing the mobile app to communicate with the API.
    *   **Rate Limiting (`throttle`):** Limits API requests per minute (e.g., 60 req/min).
    *   **Authorization Middleware (`can`):** Integrates with Spatie permissions for fine-grained access control on both web and API.
    *   **Security Middleware (`XSS`):** Provides protection against Cross-Site Scripting attacks.
    *   **Standard Web Middleware:** Includes cookie encryption, session management, CSRF protection, etc., for the web interface.

#### 3.4. External Services/Libraries (Actively Used via Routes, relevant to mobile app API)
*   `fruitcake/laravel-cors`: For handling CORS headers for API access.
*   `guzzlehttp/guzzle`: An HTTP client likely used for making requests to external services, particularly for the MTN integration.
*   `spatie/laravel-permission`: Robust role and permission management, evident in `PermissionController` and `RoleController` routes and `can` middleware, applicable to API users as well.

#### 3.5. Application Structure
*   **`app/`:** Contains core application logic: Models, Http (Controllers, Middleware), Providers, etc.
*   **`config/`:** Configuration files for various services and application settings.
*   **`database/`:** Database migrations, seeders, and factories.
*   **`public/`:** The web server's entry point, containing `index.php` and public assets.
*   **`resources/`:** Contains views (Blade templates for the web interface), language files, and uncompiled assets.
*   **`routes/`:** Defines all web (`web.php`) and API (`api.php`) routes.
*   **`storage/`:** Stores compiled Blade templates, file uploads, logs, and other generated files.
*   **`.env`:** Environment configuration for sensitive data and application settings.

### 4. People View

This section describes the different roles involved in the development, maintenance, and interaction with the `sabs-parent/server` project.

*   **Backend Developers (Laravel):**
    *   **Responsibilities:** Develop, maintain, and extend API endpoints and web functionalities; implement business logic; ensure API/web security and performance; manage database interactions; write unit and integration tests.
    *   **Key Skills:** PHP, Laravel, RESTful API design, MVC patterns, database (SQL), security best practices.
*   **Mobile App Developers (React Native):**
    *   **Responsibilities:** Consume the API endpoints to build and maintain the `sabsv3` mobile application; provide feedback on API design and functionality.
    *   **Key Skills:** JavaScript/TypeScript, React Native, understanding of RESTful APIs, mobile development best practices.
*   **Frontend Developers (Web):**
    *   **Responsibilities:** Develop and maintain the web-based user interface; ensure responsive design and user experience.
    *   **Key Skills:** HTML, CSS, JavaScript, Blade templating, frontend frameworks (if any).
*   **Database Administrators (DBAs):**
    *   **Responsibilities:** Manage the underlying database; ensure data integrity, performance, and security; perform backups and recovery.
    *   **Key Skills:** SQL, database management systems (MySQL, PostgreSQL, etc.), database optimization.
*   **DevOps/System Administrators:**
    *   **Responsibilities:** Deploy and manage the server application; ensure server health, scalability, and security; configure web servers (Apache/Nginx); manage environment variables.
    *   **Key Skills:** Linux/Windows Server administration, web server configuration, CI/CD, cloud platforms.
*   **Business Analysts/Product Owners:**
    *   **Responsibilities:** Define functional requirements; ensure the system (API and web) meets business needs; prioritize features; understand the overall purpose and value of the system.
    *   **Key Skills:** Domain knowledge (financial services, CRM), requirements gathering, project management.
*   **Security Auditors:**
    *   **Responsibilities:** Review the API and web application for vulnerabilities; ensure compliance with security standards.
    *   **Key Skills:** Web security, penetration testing, secure coding practices.

### 5. Conclusion

The `sabs-parent/server` project serves as a robust Laravel backend, offering extensive functionalities for a financial/CRM application through both API and web interfaces. Its architecture, built on Laravel 7, provides a clear separation of concerns, robust routing, and comprehensive middleware for security and performance. The MTN integration is noted as relevant for the mobile app API. This revised system design accurately reflects the actively exposed functionalities, particularly those relevant for the mobile application's API consumption, and their supporting components, enabling any individual or agent to understand the project's core components, functional scope, and the roles involved in its ecosystem.
